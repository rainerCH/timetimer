!function(){document.addEventListener("touchmove",function(a){a.preventDefault()});var a=document.querySelector("#timetimer-clock"),b=document.querySelector("#timetimer-path"),c=document.querySelector("#timetimer-display"),d=document.querySelector("#timetimer-startstop"),e=document.querySelector("#timetimer-audioalarm"),f=document.querySelector("#timetimer-centerpoint"),g=null,h=0,j=0;start_event=function(a){this._isPressed=!0,stopTimer();var b=f.getBoundingClientRect(),c=b.left+b.width/2,d=b.top+45+b.height/2;this._cx=c,this._cy=d;var e=0,g=0;"touchstart"==a.type?(e=a.targetTouches[0].pageX-c,g=a.targetTouches[0].pageY+45-d):(e=a.pageX-c,g=a.pageY+45-d);var h=180*Math.atan2(g,e)/Math.PI;h+=90,h=h>0?h-360:h;var i=-10*h;renderClock(i)},a.addEventListener("touchstart",start_event),a.addEventListener("mousedown",start_event),move_event=function(a){if(a.preventDefault(),this._isPressed){var b=0,c=0;"touchmove"==a.type?(b=a.targetTouches[0].pageX-this._cx,c=a.targetTouches[0].pageY+45-this._cy):(b=a.pageX-this._cx,c=a.pageY+45-this._cy);var d=180*Math.atan2(c,b)/Math.PI;d+=90,d=d>0?d-360:d;var e=-10*d;renderClock(e)}},a.addEventListener("touchmove",move_event),a.addEventListener("mousemove",move_event),end_event=function(b){this._isPressed=!1,d.getAttribute("class").match("stop")&&(j=a.getAttribute("data-time"),h=(new Date).getTime(),startTimer())},a.addEventListener("touchend",end_event),a.addEventListener("mouseup",end_event),digit_event=function(a){a.stopPropagation();var b=this.getAttribute("data-time");renderClock(60*b)};var k=document.querySelectorAll(".digit");for(i=0;i<k.length;i++)k[i].addEventListener("mousedown",digit_event),k[i].addEventListener("touchstart",digit_event);startStopEvent=function(){var b=this.getAttribute("class");b.match("go")?(this.setAttribute("class",b.replace(/go/,"stop")),this.textContent="Stop!",j=a.getAttribute("data-time"),j<=1&&renderClock(900),h=(new Date).getTime(),localStorage.setItem("timerState",JSON.stringify({startValue:j,startTime:h})),startTimer()):b.match("stop")&&(this.setAttribute("class",b.replace(/stop/,"go")),this.textContent="Start!",localStorage.removeItem("timerState"),document.body.removeAttribute("class"),stopTimer())},d.addEventListener("mousedown",startStopEvent),startTimer=function(){null!=g&&window.clearInterval(g),h=(new Date).getTime(),j=a.getAttribute("data-time"),g=window.setInterval(tick,1e3)},stopTimer=function(){null!=g&&(window.clearInterval(g),g=null)},renderClock=function(d){var e=d;d=Math.max(d,0),a.setAttribute("data-time",Math.round(d));var f=d/10;f=Math.max(0,f),f=Math.min(360,f),f=360-f;var g=35,h=f*Math.PI/180,i=50.0001+Math.sin(h)*g,j=60+Math.cos(h)*-g,k=f>180?0:1,l="M 50 60 v -"+g+" A "+g+" "+g+" 1 "+k+" 0 "+i+" "+j+" z";b.setAttribute("d",l);var m=Math.floor(e/60),n=Math.floor(e-60*m),o="00:"+("0"+m).substr(-2)+":"+("0"+n).substr(-2);c.textContent=o},tick=function(){if(!a._isPressed){var b=(new Date).getTime()-h;b=Math.floor(b/1e3);var c=j-b;renderClock(c),c<=0&&fireAlarm()}},fireAlarm=function(){document.body.setAttribute("class","alarming");try{e.play()}catch(a){}d.setAttribute("class","go"),d.textContent="Start!",localStorage.removeItem("timerState"),setTimeout(function(){document.body.removeAttribute("class")},5e3),stopTimer()};var l=localStorage.getItem("timerState");if(l)try{var m=JSON.parse(l);j=parseFloat(m.startValue),h=parseInt(m.startTime);var n=(new Date).getTime()-h;n=Math.floor(n/1e3);var o=j-n;renderClock(o),d.setAttribute("class","stop"),d.textContent="Stop!",startTimer()}catch(a){stopTimer(),renderClock(2700)}else renderClock(2700)}();
